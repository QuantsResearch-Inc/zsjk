# Excelで作るうどんを巡る旅

## 概要
Excelのセルを利用してさぬきうどん店を巡るルートを自動で作成するプログラムです。    
マクロを使用しています。udon.xlsmを開くときにはマクロを有効にしてください。   




## プログラムについて
ゲーム性を持たせて、ランダムに抽出した店を回る際に、時間内にたどり着けたか、店の営業時間に間に合ったかなどを考えながら、ルートを作成するアルゴリズムです。

### アルゴリズム
1. 実行が押されると、入力シートのデータをCheckInputで正しいかどうかチェックする。正しくないときはメッセージを表示して終了
1. 入力したデータをGetInput関数でInputData型のinData変数に読み込む。その際に、出発地点と終了地点の緯度経度を地点データシートから取得し、inData変数に格納する。また、評価が入力されているときには、評価データシートから評価の数値を取得しinData変数に格納する
1. 最大店舗数分の店舗一覧を、CreateShopDataList関数で、データシートからShopDataの配列spData()に読み込む。その際、絶対行きたいお店が入力されているとそのお店は必ずspData()に入れる。お好みが入力されていると、inDataの評価値以上のデータから選択する。また、お好みが入力されているとメニューの中にお好みが一致した店舗のみから選択する
1. Search関数内で、spData()の店舗内で、売り切れ次第終了の店が入ってるかどうか検査する。売り切れ次第終了の店があればその店を優先し最も近い地点の店を選択する。それ以外の時には、出発地点から順にspData()内の緯度経度との距離を調べ最も近い店舗データを選択する。この時、現在時刻が、選択した店の開店時間に達していないときには、営業開始時間が最も早い店舗を選択する
1. 選択した店舗までの距離と時間を計算する。時間はMOVE_SPEED変数で指定される時刻で計算する。また、到着した店舗が開店時間まで間があるときは開店時間まで待つ。閉店時間以降の場合にはすぐに出発する。店舗での滞在時間はEATING＿TIME変数で指定される時間とする。
1. 店舗を出発する時刻が、終了予定時刻の１時間前を超えていたら、その店で終了する


## 開始方法
入力シートを選択し、巡る最大店舗、開始時刻、終了予定時刻、出発地点、終了地点をプルダウンから選択します。絶対行きたい店、評価、食べたいうどんの種類は入力しなくても構いません。
実行ボタンを押すと、出力シートに巡るルートが表示されます。
